"use client";

import { useTranslations, useLocale } from "next-intl";
import { useState, useEffect } from "react";
import { useTheme } from "next-themes";
import Image from "next/image";
import {
  ChevronLeft,
  ChevronRight,
  Download,
  Play,
  Star,
  Users,
  Zap,
  CheckCircle,
  Target,
  Calendar,
  List,
  Sun,
  Moon,
} from "lucide-react";

type SupportedLocale = "ja" | "en" | "fr" | "ko" | "zh" | "es" | "pt" | "de";

export default function HeroSection() {
  const t = useTranslations();
  const locale = useLocale() as SupportedLocale;
  const { theme } = useTheme();
  const [currentSlide, setCurrentSlide] = useState(0);
  const [imagesLoaded, setImagesLoaded] = useState<Set<string>>(new Set());
  const [abortController, setAbortController] =
    useState<AbortController | null>(null);
  const [isLanguageSwitching, setIsLanguageSwitching] = useState(false);

  // „Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„Éï„Ç°„Ç§„É´Âêç„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
  const getScreenshotFiles = (
    language: SupportedLocale,
    mode: "dark" | "light"
  ): string[] => {
    const basePath = "/screenshots/Iphone/";
    const fileNumbers: {
      [key in SupportedLocale]: { dark: string[]; light: string[] };
    } = {
      ja: {
        dark: ["3810", "3811", "3812", "3813"],
        light: ["3814", "3815", "3816", "3817"],
      },
      en: {
        dark: ["3818", "3819", "3821", "3822"],
        light: ["3823", "3824", "3825", "3826"],
      },
      fr: {
        dark: ["3829", "3830", "3831", "3832"],
        light: ["3833", "3835", "3836", "3837"],
      },
      es: {
        dark: ["3856", "3857", "3858", "3859"],
        light: ["3860", "3861", "3862", "3863"],
      },
      de: {
        dark: ["3875", "3876", "3877", "3879"],
        light: ["3880", "3881", "3882", "3883"],
      },
      ko: {
        dark: ["3842", "3843", "3844", "3846"],
        light: ["3838", "3839", "3841", "3847"],
      },
      zh: {
        dark: ["3852", "3853", "3854", "3855"],
        light: ["3848", "3849", "3850", "3851"],
      },
      pt: {
        dark: ["3864", "3865", "3866", "3868"],
        light: ["3869", "3870", "3871", "3872"],
      },
    };

    return fileNumbers[language][mode].map(
      (num) => `${basePath}${language}_${mode}_${num}.PNG`
    );
  };

  // ÁèæÂú®„ÅÆ„ÉÜ„Éº„Éû„Å´Âü∫„Å•„ÅÑ„Å¶„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„ÇíÂãïÁöÑ„Å´ÁîüÊàê
  const getCurrentScreenshots = () => {
    // „ÉÜ„Éº„Éû„Ååsystem„ÅÆÂ†¥Âêà„ÅØdark„Çí„Éá„Éï„Ç©„É´„Éà„Å´„Åô„Çã
    const currentMode = theme === "light" ? "light" : "dark";
    const oppositeMode = currentMode === "dark" ? "light" : "dark";

    const currentModeImages = getScreenshotFiles(locale, currentMode);
    const oppositeModeImages = getScreenshotFiles(locale, oppositeMode);

    // 4Êûö„ÅØÁèæÂú®„ÅÆ„É¢„Éº„Éâ„ÄÅ5ÊûöÁõÆ„ÅØÂèçÂØæ„ÅÆ„É¢„Éº„ÉâÔºà„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà„ÇíÁ§∫„Åô„Åü„ÇÅÔºâ
    const screenshotPaths = [
      ...currentModeImages,
      oppositeModeImages[0], // ÂèçÂØæ„É¢„Éº„Éâ„ÅÆ1ÊûöÁõÆ„Çí5ÊûöÁõÆ„Å®„Åó„Å¶‰ΩøÁî®
    ];

    // „Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÁîüÊàê
    return screenshotPaths.map((src, index) => ({
      id: index + 1,
      src,
      title:
        index < 4
          ? `${t("common.screenshot")} ${index + 1}`
          : `${
              oppositeMode === "dark" ? t("common.dark") : t("common.light")
            }${t("common.modeSwitch")}`,
      alt: `TaskLap ${locale} ${
        index < 4 ? currentMode : oppositeMode
      } screenshot ${index + 1}`,
    }));
  };

  const screenshots = getCurrentScreenshots();
  const isLastSlide = currentSlide === screenshots.length - 1;
  const currentMode = theme === "light" ? "light" : "dark";
  const oppositeMode = currentMode === "dark" ? "light" : "dark";

  // ÁîªÂÉèË™≠„ÅøËæº„ÅøÂÆå‰∫Ü„ÉÅ„Çß„ÉÉ„ÇØ
  const isCurrentImageLoaded = screenshots[currentSlide]
    ? imagesLoaded.has(screenshots[currentSlide].src)
    : false;

  // Ê¨°„ÅÆ„Çπ„É©„Ç§„Éâ„ÅåË™≠„ÅøËæº„ÅøÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  const nextSlideIndex = (currentSlide + 1) % screenshots.length;
  const isNextImageLoaded = screenshots[nextSlideIndex]
    ? imagesLoaded.has(screenshots[nextSlideIndex].src)
    : false;

  // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ‰∏ÄÊã¨„Éó„É™„É≠„Éº„ÉâÔºàËµ∑ÂãïÊôÇ & ÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÂÆå‰∫ÜÂæåÔºâ
  useEffect(() => {
    const backgroundPreload = () => {
      // Ë®ÄË™ûÂàá„ÇäÊõø„Åà‰∏≠„ÅØ‰∏ÄÊã¨„Éó„É™„É≠„Éº„Éâ„ÇíÂÆüË°å„Åó„Å™„ÅÑ
      if (isLanguageSwitching) return;

      const allLanguages: SupportedLocale[] = [
        "ja",
        "en",
        "fr",
        "ko",
        "zh",
        "es",
        "pt",
        "de",
      ];
      const allModes: ("dark" | "light")[] = ["dark", "light"];

      // ÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÁî®„ÅÆ„É™„É≥„ÇØ„ÅØ‰øùÊåÅ„Åó„ÄÅ„Åù„Çå‰ª•Â§ñ„Çí„ÇØ„É™„Ç¢
      const existingLinks = document.querySelectorAll(
        'link[rel="preload"][data-screenshot-preload="true"]:not([data-priority-switch="true"])'
      );
      existingLinks.forEach((link) => link.remove());

      // „Åô„Åπ„Å¶„ÅÆÁµÑ„ÅøÂêà„Çè„Åõ„ÅÆÁîªÂÉèURL„ÇíÁîüÊàê
      const allImageUrls: string[] = [];
      allLanguages.forEach((lang) => {
        allModes.forEach((mode) => {
          const images = getScreenshotFiles(lang, mode);
          allImageUrls.push(...images);
        });
      });

      // ÈáçË§á„ÇíÈô§Âéª
      const uniqueImageUrls = Array.from(new Set(allImageUrls));

      // ÁèæÂú®„ÅÆË®ÄË™û„Éª„É¢„Éº„Éâ„ÅÆÁîªÂÉè„ÇíÈô§Â§ñÔºàÊó¢„Å´ÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÊ∏à„ÅøÔºâ
      const currentImages = screenshots.map((s) => s.src);
      const currentImageSet = new Set(currentImages);
      const backgroundImages = uniqueImageUrls.filter(
        (src) => !currentImageSet.has(src)
      );

      // ‰ΩéÂÑ™ÂÖàÂ∫¶„Åß„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Éó„É™„É≠„Éº„Éâ
      backgroundImages.forEach((src) => {
        const link = document.createElement("link");
        link.rel = "preload";
        link.as = "image";
        link.href = src;
        link.setAttribute("data-screenshot-preload", "true");
        link.setAttribute("fetchpriority", "low");
        link.setAttribute("data-background-preload", "true");
        document.head.appendChild(link);
      });

      console.log(
        `üîÑ „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Éó„É™„É≠„Éº„Éâ: ${backgroundImages.length} Êûö„ÅÆÁîªÂÉè (‰ªñË®ÄË™û„Éª„É¢„Éº„Éâ)`
      );
    };

    // Ë®ÄË™ûÂàá„ÇäÊõø„Åà„ÅåÂÆå‰∫Ü„Åó„Å¶„Åã„Çâ2ÁßíÂæå„Å´„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Éó„É™„É≠„Éº„ÉâÈñãÂßã
    const timer = setTimeout(
      backgroundPreload,
      isLanguageSwitching ? 2000 : 1000
    );

    return () => {
      clearTimeout(timer);
    };
  }, [isLanguageSwitching, locale, theme]); // eslint-disable-line react-hooks/exhaustive-deps

  // ÁèæÂú®„ÅÆË®ÄË™û„Éª„É¢„Éº„ÉâÁî®„ÅÆËøΩÂä†ÊúÄÈÅ©Âåñ
  useEffect(() => {
    const optimizeCurrentImages = () => {
      const currentImages = screenshots.map((screenshot) => screenshot.src);

      // ÁèæÂú®„ÅÆÁîªÂÉè„Çª„ÉÉ„Éà„ÇíÊúÄÂÑ™ÂÖà„ÅßÁ¢∫ÂÆü„Å´„Ç≠„É£„ÉÉ„Ç∑„É•
      currentImages.forEach((src, index) => {
        const img = new window.Image();
        img.fetchPriority = "high";
        img.loading = "eager";
        img.src = src;

        img.onload = () => {
          setImagesLoaded((prev) => new Set(prev).add(src));
        };
      });
    };

    optimizeCurrentImages();
  }, [locale, theme]); // eslint-disable-line react-hooks/exhaustive-deps

  // Èö£Êé•„Çπ„É©„Ç§„Éâ„ÅÆÁ©çÊ•µÁöÑ„Éó„É™„É≠„Éº„Éâ
  useEffect(() => {
    const preloadAdjacentSlides = async () => {
      const allImages = screenshots.map((screenshot) => screenshot.src);

      // Èö£Êé•„Åô„ÇãÁîªÂÉè„ÇíÂç≥Â∫ß„Å´„É≠„Éº„Éâ
      const nextIndex = (currentSlide + 1) % allImages.length;
      const prevIndex =
        (currentSlide - 1 + allImages.length) % allImages.length;

      // Èö£Êé•ÁîªÂÉè„ÇíÈ´òÂÑ™ÂÖàÂ∫¶„ÅßÂç≥Â∫ß„Å´„Éó„É™„É≠„Éº„Éâ
      [allImages[nextIndex], allImages[prevIndex]].forEach((src) => {
        if (src && !imagesLoaded.has(src)) {
          const img = new window.Image();
          img.fetchPriority = "high";
          img.loading = "eager";
          img.onload = () => setImagesLoaded((prev) => new Set(prev).add(src));
          img.src = src;
        }
      });
    };

    preloadAdjacentSlides();
  }, [currentSlide, screenshots, imagesLoaded]);

  // Service WorkerÈ¢®„ÅÆ„Ç≠„É£„ÉÉ„Ç∑„É≥„Ç∞Êà¶Áï•
  useEffect(() => {
    const setupAdvancedCaching = () => {
      // „Çà„ÇäÁ©çÊ•µÁöÑ„Å™„Ç≠„É£„ÉÉ„Ç∑„É≥„Ç∞
      const allLanguages: SupportedLocale[] = [
        "ja",
        "en",
        "fr",
        "ko",
        "zh",
        "es",
        "pt",
        "de",
      ];
      const currentLangImages = new Set<string>();

      // ÁèæÂú®„ÅÆË®ÄË™û„ÅÆÂÖ®„É¢„Éº„ÉâÁîªÂÉè„ÇíÊúÄÂÑ™ÂÖà„Åß„Ç≠„É£„ÉÉ„Ç∑„É•
      ["dark", "light"].forEach((mode) => {
        const images = getScreenshotFiles(locale, mode as "dark" | "light");
        images.forEach((src) => {
          currentLangImages.add(src);
          if (!imagesLoaded.has(src)) {
            const img = new window.Image();
            img.fetchPriority = "high";
            img.src = src;
            img.onload = () =>
              setImagesLoaded((prev) => new Set(prev).add(src));
          }
        });
      });

      // ‰ΩøÁî®È†ªÂ∫¶„ÅÆÈ´ò„ÅÑË®ÄË™û„ÇíÊ¨°„Å´ÂÑ™ÂÖàÔºàÊó•Êú¨Ë™û„ÄÅËã±Ë™û„ÇíÂÑ™ÂÖàÔºâ
      const priorityLanguages: SupportedLocale[] = ["ja", "en"];
      priorityLanguages.forEach((lang) => {
        if (lang !== locale) {
          ["dark", "light"].forEach((mode) => {
            const images = getScreenshotFiles(lang, mode as "dark" | "light");
            images.forEach((src) => {
              if (!currentLangImages.has(src) && !imagesLoaded.has(src)) {
                // ‰ΩéÂÑ™ÂÖàÂ∫¶„Åß„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„É≠„Éº„Éâ
                setTimeout(() => {
                  const img = new window.Image();
                  img.fetchPriority = "low";
                  img.src = src;
                  img.onload = () =>
                    setImagesLoaded((prev) => new Set(prev).add(src));
                }, Math.random() * 2000); // „É©„É≥„ÉÄ„É†ÈÅÖÂª∂„Åß„Çµ„Éº„Éê„ÉºË≤†Ëç∑ÂàÜÊï£
              }
            });
          });
        }
      });
    };

    setupAdvancedCaching();
  }, [locale]); // eslint-disable-line react-hooks/exhaustive-deps

  // „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„Ç¢„É≥„Éû„Ç¶„É≥„ÉàÊôÇ„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
  useEffect(() => {
    return () => {
      // ÈÄ≤Ë°å‰∏≠„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Çí„Ç≠„É£„É≥„Çª„É´
      if (abortController) {
        abortController.abort();
      }

      // „Éó„É™„É≠„Éº„Éâ„É™„É≥„ÇØ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
      const allPreloadLinks = document.querySelectorAll(
        'link[rel="preload"][data-screenshot-preload="true"]'
      );
      allPreloadLinks.forEach((link) => link.remove());

      console.log("üßπ HeroSection: „É™„ÇΩ„Éº„Çπ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü");
    };
  }, []); // eslint-disable-line react-hooks/exhaustive-deps

  // Á∑äÊÄ•ÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÊ©üËÉΩÔºàË®ÄË™û„Éª„É¢„Éº„ÉâÂàá„ÇäÊõø„ÅàÊôÇÔºâ
  useEffect(() => {
    const priorityDownloadOnSwitch = async () => {
      setIsLanguageSwitching(true);

      // Êó¢Â≠ò„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Çí„Ç≠„É£„É≥„Çª„É´
      if (abortController) {
        abortController.abort();
      }

      // Êñ∞„Åó„ÅÑAbortController„Çí‰ΩúÊàê
      const newAbortController = new AbortController();
      setAbortController(newAbortController);

      try {
        console.log(
          `üöÄ Ë®ÄË™û„Éª„É¢„Éº„ÉâÂàá„ÇäÊõø„ÅàÊ§úÁü•: ${locale} ${currentMode}„É¢„Éº„Éâ - ÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÈñãÂßã`
        );

        // ÁèæÂú®„ÅÆË®ÄË™û„Éª„É¢„Éº„Éâ„ÅÆÁîªÂÉè„ÇíÊúÄÂÑ™ÂÖà„ÅßÂç≥Â∫ß„Å´„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        const currentImages = getScreenshotFiles(locale, currentMode);
        const oppositeImages = getScreenshotFiles(locale, oppositeMode);
        const priorityImages = [...currentImages, ...oppositeImages];

        // Êó¢Â≠ò„ÅÆ„Éó„É™„É≠„Éº„Éâ„É™„É≥„ÇØ„ÇíÂÖ®ÂâäÈô§
        const existingLinks = document.querySelectorAll(
          'link[rel="preload"][data-screenshot-preload="true"]'
        );
        existingLinks.forEach((link) => link.remove());

        // Êñ∞„Åó„ÅÑË®ÄË™û„Éª„É¢„Éº„Éâ„ÇíË∂ÖÈ´òÂÑ™ÂÖàÂ∫¶„Åß„Éó„É™„É≠„Éº„Éâ
        priorityImages.forEach((src, index) => {
          const link = document.createElement("link");
          link.rel = "preload";
          link.as = "image";
          link.href = src;
          link.setAttribute("data-screenshot-preload", "true");
          link.setAttribute("fetchpriority", "high");
          link.setAttribute("data-priority-switch", "true");
          // ÊúÄÂÑ™ÂÖà„ÅßDOMÂÖàÈ†≠„Å´ÊåøÂÖ•
          document.head.insertBefore(link, document.head.firstChild);
        });

        // JavaScript „É¨„Éô„É´„Åß„ÇÇ‰∏¶Ë°å„Åó„Å¶ÊúÄÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        const downloadPromises = priorityImages.map((src, index) => {
          return new Promise<void>((resolve) => {
            const img = new window.Image();
            img.fetchPriority = "high";
            img.loading = "eager";

            img.onload = () => {
              setImagesLoaded((prev) => new Set(prev).add(src));
              console.log(`‚úÖ ÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÂÆå‰∫Ü: ${src.split("/").pop()}`);
              resolve();
            };

            img.onerror = () => {
              console.warn(`‚ùå ÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÂ§±Êïó: ${src}`);
              resolve();
            };

            // AbortController„Åß„Ç≠„É£„É≥„Çª„É´ÂèØËÉΩ„Å´
            newAbortController.signal.addEventListener("abort", () => {
              img.src = ""; // „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÇíÂÅúÊ≠¢
              resolve();
            });

            img.src = src;
          });
        });

        // ÁèæÂú®„ÅÆ„É¢„Éº„Éâ„ÅÆÁîªÂÉè„ÇíÊúÄÂÑ™ÂÖà„ÅßÂæÖÊ©ü
        await Promise.all(downloadPromises.slice(0, 4)); // ÊúÄÂàù„ÅÆ4ÊûöÔºàÁèæÂú®„É¢„Éº„ÉâÔºâ
        console.log(
          `üéØ ${locale} ${currentMode}„É¢„Éº„Éâ - „É°„Ç§„É≥ÁîªÂÉè„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÂÆå‰∫Ü`
        );

        // ÂèçÂØæ„É¢„Éº„Éâ„ÅÆÁîªÂÉè„ÇÇ„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„ÅßÂÆå‰∫Ü
        await Promise.all(downloadPromises.slice(4)); // ÊÆã„Çä„ÅÆÁîªÂÉè
        console.log(`üåü ${locale} ÂÖ®„É¢„Éº„ÉâÁîªÂÉè„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÂÆå‰∫Ü`);
      } catch (error) {
        if (error instanceof Error && error.name === "AbortError") {
          console.log(
            "üìã ÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„ÅüÔºàÊñ∞„Åó„ÅÑÂàá„ÇäÊõø„Åà„ÅÆ„Åü„ÇÅÔºâ"
          );
        } else {
          console.error("ÂÑ™ÂÖà„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Ç®„É©„Éº:", error);
        }
      } finally {
        setIsLanguageSwitching(false);
      }
    };

    priorityDownloadOnSwitch();
  }, [theme, locale]); // eslint-disable-line react-hooks/exhaustive-deps

  // „Çπ„É©„Ç§„Éâ„Çí„É™„Çª„ÉÉ„ÉàÔºà„ÉÜ„Éº„Éû„Åæ„Åü„ÅØË®ÄË™ûÂ§âÊõ¥ÊôÇÔºâ
  useEffect(() => {
    setCurrentSlide(0);
    setImagesLoaded(new Set()); // ÁîªÂÉèË™≠„ÅøËæº„ÅøÁä∂ÊÖã„ÇÇ„É™„Çª„ÉÉ„Éà
  }, [theme, locale]);

  // ÁîªÂÉèË™≠„ÅøËæº„ÅøÁä∂ÊÖã„Å´Âü∫„Å•„ÅÑ„ÅüËá™Âãï„Çπ„É©„Ç§„ÉâÊ©üËÉΩ
  useEffect(() => {
    const timer = setInterval(
      () => {
        // Ê¨°„ÅÆÁîªÂÉè„ÅåË™≠„ÅøËæº„ÅøÂÆå‰∫Ü„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Åø„Çπ„É©„Ç§„Éâ
        if (isNextImageLoaded) {
          setCurrentSlide((prev) => (prev + 1) % screenshots.length);
        }
        // Ë™≠„ÅøËæº„ÅøÊú™ÂÆå‰∫Ü„ÅÆÂ†¥Âêà„ÅØ500msÂæå„Å´ÂÜç„ÉÅ„Çß„ÉÉ„ÇØ
      },
      isNextImageLoaded ? 4000 : 500
    );

    return () => clearInterval(timer);
  }, [screenshots.length, isNextImageLoaded]);

  const nextSlide = () => {
    const nextIndex = (currentSlide + 1) % screenshots.length;
    const nextImage = screenshots[nextIndex];

    // Ê¨°„ÅÆÁîªÂÉè„ÅåË™≠„ÅøËæº„ÅøÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´Âàá„ÇäÊõø„Åà
    if (nextImage && imagesLoaded.has(nextImage.src)) {
      setCurrentSlide(nextIndex);
    } else {
      // Êú™Ë™≠„ÅøËæº„Åø„ÅÆÂ†¥Âêà„ÅØË™≠„ÅøËæº„Åø„Çí‰øÉÈÄ≤„Åó„Å¶„Åã„ÇâÂàá„ÇäÊõø„Åà
      if (nextImage) {
        const img = new window.Image();
        img.fetchPriority = "high";
        img.onload = () => {
          setImagesLoaded((prev) => new Set(prev).add(nextImage.src));
          setCurrentSlide(nextIndex);
        };
        img.src = nextImage.src;
      }
    }
  };

  const prevSlide = () => {
    const prevIndex =
      (currentSlide - 1 + screenshots.length) % screenshots.length;
    const prevImage = screenshots[prevIndex];

    // Ââç„ÅÆÁîªÂÉè„ÅåË™≠„ÅøËæº„ÅøÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´Âàá„ÇäÊõø„Åà
    if (prevImage && imagesLoaded.has(prevImage.src)) {
      setCurrentSlide(prevIndex);
    } else {
      // Êú™Ë™≠„ÅøËæº„Åø„ÅÆÂ†¥Âêà„ÅØË™≠„ÅøËæº„Åø„Çí‰øÉÈÄ≤„Åó„Å¶„Åã„ÇâÂàá„ÇäÊõø„Åà
      if (prevImage) {
        const img = new window.Image();
        img.fetchPriority = "high";
        img.onload = () => {
          setImagesLoaded((prev) => new Set(prev).add(prevImage.src));
          setCurrentSlide(prevIndex);
        };
        img.src = prevImage.src;
      }
    }
  };

  const scrollToSection = (sectionId: string) => {
    const element = document.getElementById(sectionId);
    if (element) {
      element.scrollIntoView({ behavior: "smooth" });
    }
  };

  return (
    <section className="relative min-h-screen flex items-center justify-center section-warm overflow-hidden pt-14 sm:pt-16">
      {/* TaskLap„Ç¢„Éó„É™È¢®„ÅÆËÉåÊôØË£ÖÈ£æ */}
      <div className="absolute inset-0 overflow-hidden">
        <div className="absolute -top-40 -right-40 w-80 h-80 bg-primary-200/30 dark:bg-primary-900/20 rounded-full blur-3xl animate-float"></div>
        <div
          className="absolute -bottom-40 -left-40 w-96 h-96 bg-warm-200/40 dark:bg-primary-800/20 rounded-full blur-3xl animate-float"
          style={{ animationDelay: "2s" }}
        ></div>
        <div
          className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-primary-100/20 dark:bg-primary-900/10 rounded-full blur-3xl animate-float"
          style={{ animationDelay: "4s" }}
        ></div>
      </div>

      <div className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-20">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 sm:gap-12 items-center">
          {/* Left Content - TaskLap„Ç¢„Éó„É™È¢®„Éá„Ç∂„Ç§„É≥ */}
          <div className="text-center lg:text-left space-y-8">
            {/* Badge - ÂÆüÈöõ„ÅÆTaskLap„Ç¢„Ç§„Ç≥„É≥„Çí‰ΩøÁî® */}
            <div className="inline-flex items-center px-6 py-3 bg-primary-500/90 backdrop-blur-sm rounded-full text-white text-sm font-medium shadow-warm">
              <div className="relative w-5 h-5 mr-2 rounded-md overflow-hidden bg-white/20">
                <Image
                  src="/app_icon_transparent.png"
                  alt="TaskLap Icon"
                  width={20}
                  height={20}
                  className="w-full h-full object-contain rounded-md "
                />
              </div>
              <span>{t("hero.simpleTaskManagement")}</span>
            </div>

            {/* Main Title - Êöñ„Åã„ÅÑ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ */}
            <div className="space-y-3 sm:space-y-4">
              <h1 className="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-neutral-800 dark:text-neutral-100 leading-tight">
                {t("hero.title")}
              </h1>
              <p className="text-lg sm:text-xl md:text-2xl text-primary-600 dark:text-primary-400 font-medium">
                {t("hero.subtitle")}
              </p>
            </div>

            {/* Description */}
            <p className="text-base sm:text-lg text-neutral-600 dark:text-neutral-400 leading-relaxed max-w-2xl">
              {t("hero.description")}
            </p>

            {/* Stats - TaskLap„Ç¢„Éó„É™È¢®„Ç¢„Ç§„Ç≥„É≥ */}
            <div className="flex flex-wrap justify-center lg:justify-start gap-4 sm:gap-6 py-3 sm:py-4">
              <div className="flex items-center space-x-1.5 sm:space-x-2 text-neutral-700 dark:text-neutral-300">
                <div className="w-6 h-6 sm:w-8 sm:h-8 bg-yellow-400 rounded-lg flex items-center justify-center">
                  <Star className="w-3 h-3 sm:w-4 sm:h-4 text-white" />
                </div>
                <span className="text-xs sm:text-sm font-medium">
                  {t("hero.badges.ratingPreparation")}
                </span>
              </div>
              <div className="flex items-center space-x-1.5 sm:space-x-2 text-neutral-700 dark:text-neutral-300">
                <div className="w-6 h-6 sm:w-8 sm:h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                  <Users className="w-3 h-3 sm:w-4 sm:h-4 text-white" />
                </div>
                <span className="text-xs sm:text-sm font-medium">
                  {t("hero.badges.multilingualSupport")}
                </span>
              </div>
              <div className="flex items-center space-x-1.5 sm:space-x-2 text-neutral-700 dark:text-neutral-300">
                <div className="w-6 h-6 sm:w-8 sm:h-8 bg-purple-500 rounded-lg flex items-center justify-center">
                  <div className="flex items-center justify-center w-full h-full">
                    {theme === "dark" ? (
                      <svg
                        className="w-3 h-3 sm:w-4 sm:h-4 text-white"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                      </svg>
                    ) : (
                      <svg
                        className="w-3 h-3 sm:w-4 sm:h-4 text-white"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z" />
                      </svg>
                    )}
                  </div>
                </div>
                <span className="text-xs sm:text-sm font-medium">
                  {t("common.darkLightMode")}
                </span>
              </div>
              <div className="flex items-center space-x-1.5 sm:space-x-2 text-neutral-700 dark:text-neutral-300">
                <div className="w-6 h-6 sm:w-8 sm:h-8 bg-green-500 rounded-lg flex items-center justify-center">
                  <Download className="w-3 h-3 sm:w-4 sm:h-4 text-white" />
                </div>
                <span className="text-xs sm:text-sm font-medium">
                  {t("hero.badges.freeDownload")}
                </span>
              </div>
            </div>

            {/* CTA Buttons - TaskLap„Ç¢„Éó„É™È¢® */}
            {/* ÂÖ¨Âºè„Çπ„Éà„Ç¢„Éê„ÉÉ„Ç∏ */}
            <div className="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-3 sm:pt-4 items-center lg:items-start lg:justify-start justify-center">
              <a
                href="#"
                className="block transition-transform hover:scale-105"
                aria-label="App Store „Åã„Çâ„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÔºàÁî≥Ë´ã‰∏≠Ôºâ"
              >
                <img
                  src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Download_on_the_App_Store_Badge.svg"
                  alt="App Store „Åã„Çâ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ"
                  className="h-[36px] sm:h-[48px] w-auto"
                />
              </a>
              <a
                href="#"
                className="block transition-transform hover:scale-105"
                aria-label="Get it on Google PlayÔºàÁî≥Ë´ã‰∏≠Ôºâ"
              >
                <img
                  src="https://raw.githubusercontent.com/pioug/google-play-badges/main/svg/English.svg"
                  alt="Get it on Google Play"
                  className="h-[36px] sm:h-[48px] w-auto"
                />
              </a>
            </div>

            {/* Áî≥Ë´ã‰∏≠„É°„ÉÉ„Çª„Éº„Ç∏ */}
            <div className="pt-3 sm:pt-4">
              <div className="inline-flex items-center px-3 sm:px-4 py-1.5 sm:py-2 bg-primary-50 dark:bg-primary-900/20 rounded-lg border border-primary-200 dark:border-primary-700">
                <span className="text-xs sm:text-sm text-primary-700 dark:text-primary-300">
                  {t("common.applicationInProgress")}
                </span>
              </div>
            </div>

            {/* Ê©üËÉΩÁ¢∫Ë™ç„Éú„Çø„É≥ */}
            <div className="pt-3 sm:pt-4">
              <button
                onClick={() => scrollToSection("focus-mode")}
                className="group btn-secondary px-5 sm:px-6 md:px-8 py-2.5 sm:py-3 md:py-4 rounded-xl sm:rounded-xl md:rounded-2xl font-semibold text-sm sm:text-base md:text-lg flex items-center justify-center space-x-1.5 sm:space-x-2 md:space-x-3"
              >
                <Play className="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6" />
                <span>{t("hero.viewFeatures")}</span>
              </button>
            </div>

            {/* Platform badges - TaskLap„Ç¢„Éó„É™È¢® */}
            <div className="flex flex-col sm:flex-row items-center gap-3 sm:gap-4 pt-6 sm:pt-8">
              <span className="text-neutral-500 dark:text-neutral-400 text-xs sm:text-sm font-medium">
                {t("hero.availableOn")}
              </span>
              <div className="flex items-center gap-3 sm:gap-4">
                <div className="bg-warm-200 dark:bg-neutral-700 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl flex items-center space-x-1.5 sm:space-x-2 shadow-warm">
                  <span className="text-neutral-700 dark:text-neutral-300 text-xs sm:text-sm font-medium">
                    üçé iOS 16.0+
                  </span>
                </div>
                <div className="bg-warm-200 dark:bg-neutral-700 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl flex items-center space-x-1.5 sm:space-x-2 shadow-warm">
                  <span className="text-neutral-700 dark:text-neutral-300 text-xs sm:text-sm font-medium">
                    ü§ñ Android 8.0+
                  </span>
                </div>
              </div>
            </div>
          </div>

          {/* Right Content - TaskLap„Ç¢„Éó„É™„ÅÆÂÆüÈöõ„ÅÆ„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà */}
          <div className="relative">
            <div className="relative max-w-[280px] sm:max-w-xs md:max-w-sm mx-auto">
              {/* Phone Frame - TaskLap„Ç¢„Éó„É™È¢® */}
              <div className="relative bg-black rounded-[2rem] sm:rounded-[2.5rem] md:rounded-[3rem] p-2.5 sm:p-3 md:p-4 shadow-warm-xl">
                <div className="bg-black rounded-[1.5rem] sm:rounded-[2rem] md:rounded-[2.5rem] overflow-hidden aspect-[9/19.5] relative">
                  {/* Screenshot Carousel - TaskLap„Ç¢„Éó„É™„ÅÆÂÆüÈöõ„ÅÆ„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà */}
                  <div className="relative h-full">
                    {screenshots.map((screenshot, index) => {
                      const isLoaded = imagesLoaded.has(screenshot.src);
                      return (
                        <div
                          key={`${locale}-${currentMode}-${screenshot.id}`}
                          className={`absolute inset-0 transition-all duration-500 ${
                            index === currentSlide ? "opacity-100" : "opacity-0"
                          }`}
                        >
                          <Image
                            src={screenshot.src}
                            alt={screenshot.alt}
                            fill
                            className={`object-contain object-center transition-opacity duration-300 ${
                              isLoaded ? "opacity-100" : "opacity-50"
                            }`}
                            priority={true} // „Åô„Åπ„Å¶„ÅÆÁîªÂÉè„ÇíÂÑ™ÂÖàË™≠„ÅøËæº„Åø
                            loading="eager" // Âç≥Â∫ß„Å´Ë™≠„ÅøËæº„Åø
                            sizes="(max-width: 640px) 220px, (max-width: 768px) 280px, 400px"
                            quality={85} // ÂìÅË≥™„Å®ÈÄüÂ∫¶„ÅÆ„Éê„É©„É≥„Çπ
                          />
                          {/* „É≠„Éº„Éá„Ç£„É≥„Ç∞Áä∂ÊÖãË°®Á§∫ */}
                          {(!isLoaded || isLanguageSwitching) && (
                            <div className="absolute inset-0 flex items-center justify-center bg-neutral-900/30 backdrop-blur-sm">
                              <div className="text-center">
                                <div className="w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-2"></div>
                                {isLanguageSwitching && (
                                  <div className="text-white text-xs px-2 py-1 bg-black/50 rounded">
                                    üöÄ ÊúÄÈÅ©Âåñ‰∏≠...
                                  </div>
                                )}
                              </div>
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>

                  {/* Navigation arrows */}
                  <button
                    onClick={prevSlide}
                    className="absolute left-1 sm:left-2 top-1/2 transform -translate-y-1/2 bg-black/40 backdrop-blur-sm text-white p-1.5 sm:p-2 rounded-full hover:bg-black/60 transition-colors z-10"
                    aria-label="Ââç„ÅÆ„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà"
                  >
                    <ChevronLeft className="w-3 h-3 sm:w-4 sm:h-4" />
                  </button>
                  <button
                    onClick={nextSlide}
                    className="absolute right-1 sm:right-2 top-1/2 transform -translate-y-1/2 bg-black/40 backdrop-blur-sm text-white p-1.5 sm:p-2 rounded-full hover:bg-black/60 transition-colors z-10"
                    aria-label="Ê¨°„ÅÆ„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà"
                  >
                    <ChevronRight className="w-3 h-3 sm:w-4 sm:h-4" />
                  </button>

                  {/* „É¢„Éº„ÉâÂàá„ÇäÊõø„ÅàË™¨ÊòéÔºà5ÊûöÁõÆ„ÅÆÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ */}
                  {isLastSlide && (
                    <div className="absolute bottom-2 sm:bottom-4 left-1/2 transform -translate-x-1/2 bg-black/70 backdrop-blur-sm text-white px-2 sm:px-3 py-1 sm:py-2 rounded-lg text-xs text-center z-20">
                      <div className="flex items-center space-x-1">
                        {currentMode === "dark" ? (
                          <>
                            <Sun className="w-2.5 h-2.5 sm:w-3 sm:h-3" />
                            <span className="text-xs sm:text-sm">
                              {t("common.lightMode")}
                            </span>
                          </>
                        ) : (
                          <>
                            <Moon className="w-2.5 h-2.5 sm:w-3 sm:h-3" />
                            <span className="text-xs sm:text-sm">
                              {t("common.darkMode")}
                            </span>
                          </>
                        )}
                      </div>
                    </div>
                  )}
                </div>

                {/* Screen reflection effect */}
                <div className="absolute inset-3 sm:inset-4 bg-gradient-to-t from-white/10 to-transparent rounded-[2rem] sm:rounded-[2.5rem] pointer-events-none"></div>
              </div>

              {/* TaskLap„Ç¢„Éó„É™È¢®„ÅÆ„Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞Ë¶ÅÁ¥† */}
              <div className="absolute -top-3 -left-3 sm:-top-4 sm:-left-4 w-6 h-6 sm:w-8 sm:h-8 bg-primary-400 rounded-full opacity-80 animate-float shadow-warm"></div>
              <div
                className="absolute -bottom-3 -right-3 sm:-bottom-4 sm:-right-4 w-5 h-5 sm:w-6 sm:h-6 bg-warm-400 rounded-full opacity-80 animate-float shadow-warm"
                style={{ animationDelay: "1s" }}
              ></div>
              <div
                className="absolute top-1/2 -right-6 sm:-right-8 w-3 h-3 sm:w-4 sm:h-4 bg-primary-300 rounded-full opacity-80 animate-float shadow-warm"
                style={{ animationDelay: "3s" }}
              ></div>
            </div>

            {/* Screenshot indicators - TaskLap„Ç¢„Éó„É™È¢® */}
            <div className="flex justify-center space-x-1.5 sm:space-x-2 mt-6 sm:mt-8">
              {screenshots.map((_, index) => (
                <button
                  key={index}
                  onClick={() => setCurrentSlide(index)}
                  className={`w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full transition-all duration-300 ${
                    index === currentSlide
                      ? "bg-primary-500 shadow-warm w-4 sm:w-6"
                      : "bg-warm-300 dark:bg-neutral-600"
                  }`}
                  aria-label={`„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà ${index + 1} „ÇíË°®Á§∫`}
                />
              ))}
            </div>
          </div>
        </div>
      </div>

      {/* Scroll indicator - TaskLap„Ç¢„Éó„É™È¢® */}
      <div className="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
        <div className="w-6 h-10 border-2 border-primary-400/60 dark:border-primary-500/60 rounded-full flex justify-center">
          <div className="w-1 h-3 bg-primary-500/80 rounded-full mt-2 animate-pulse"></div>
        </div>
      </div>
    </section>
  );
}
